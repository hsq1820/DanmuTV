# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢ä½ è€ƒè™‘ä¸º DanmuTV åšå‡ºè´¡çŒ®!

## é¡¹ç›®èµ·æº

DanmuTV åŸºäº [MoonTV](https://github.com/MoonTechLab/LunaTV) é¡¹ç›®äºŒæ¬¡å¼€å‘ã€‚

**ä¸»è¦æ”¹åŠ¨**:
- æ·»åŠ å®Œæ•´çš„å¼¹å¹•ç³»ç»Ÿæ”¯æŒ
- ç§»é™¤äº‘ç«¯å­˜å‚¨ï¼Œæ”¹ç”¨æœ¬åœ° localStorage
- ç§»é™¤ä¸‹è½½åŠŸèƒ½å’Œç”¨æˆ·ç³»ç»Ÿ
- ä¼˜åŒ– Electron æ‰“åŒ…ä½“ç§¯
- æ”¹è¿›ç”¨æˆ·äº¤äº’ä½“éªŒ

## å¼€å‘ç¯å¢ƒ

### å¿…éœ€å·¥å…·
- Node.js >= 18
- pnpm >= 8

### å®‰è£…ä¾èµ–
```bash
pnpm install
```

### å¼€å‘æ¨¡å¼
```bash
pnpm dev
```

## é¡¹ç›®ç»“æ„

```
DanmuTV/
â”œâ”€â”€ electron/              # Electron ä¸»è¿›ç¨‹
â”‚   â””â”€â”€ main.js           # åº”ç”¨å¯åŠ¨ã€çª—å£ç®¡ç†
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/              # Next.js åº”ç”¨è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ page.tsx      # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ search/       # æœç´¢é¡µ
â”‚   â”‚   â”œâ”€â”€ douban/       # è±†ç“£æ¨è
â”‚   â”‚   â””â”€â”€ play/         # æ’­æ”¾é¡µï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ components/       # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ UserMenu.tsx  # è§†é¢‘æºç®¡ç†
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ lib/              # å·¥å…·åº“
â”‚       â”œâ”€â”€ db.client.ts  # æœ¬åœ°å­˜å‚¨å°è£…
â”‚       â”œâ”€â”€ client-search.ts # å®¢æˆ·ç«¯æœç´¢
â”‚       â””â”€â”€ default-video-sources.ts # é»˜è®¤è§†é¢‘æº
â””â”€â”€ public/               # é™æ€èµ„æº
```

## æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### å¼¹å¹•ç³»ç»Ÿ
- ä½ç½®: `src/app/play/page.tsx`
- æ’ä»¶: `artplayer-plugin-danmuku`
- æ”¯æŒæ ¼å¼: Bilibili XML
- å…³é”®å‡½æ•°:
  - `loadDanmakuFromBilibili()` - ä» Bç«™åŠ è½½å¼¹å¹•
  - `buildDanmakuFilter()` - æ„å»ºå¼¹å¹•è¿‡æ»¤å™¨
  - `reloadDanmakuWithFilter()` - åº”ç”¨è¿‡æ»¤é‡è½½å¼¹å¹•

### æœ¬åœ°å­˜å‚¨
- ä½ç½®: `src/lib/db.client.ts`
- å­˜å‚¨æ–¹å¼: `localStorage`
- æ•°æ®ç±»å‹:
  - `danmutv_play_records` - æ’­æ”¾è®°å½•
  - `danmutv_favorites` - æ”¶è—åˆ—è¡¨
  - `danmutv_search_history` - æœç´¢å†å²
  - `danmaku_keywords` - å…³é”®è¯å±è”½
  - `danmaku_limit_per_sec` - å¯†åº¦é™åˆ¶

### è§†é¢‘æºç®¡ç†
- ä½ç½®: `src/components/UserMenu.tsx`
- é»˜è®¤æº: `src/lib/default-video-sources.ts`
- ç”¨æˆ·å¯æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤è§†é¢‘æº

## ä»£ç è§„èŒƒ

### TypeScript
- ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
- ä¸ºå…¬å…±å‡½æ•°æ·»åŠ ç±»å‹æ³¨è§£
- é¿å…ä½¿ç”¨ `any`

### React
- ä¼˜å…ˆä½¿ç”¨å‡½æ•°ç»„ä»¶
- åˆç†ä½¿ç”¨ `useCallback` å’Œ `useMemo`
- æå–å¯å¤ç”¨ç»„ä»¶

### æ ·å¼
- ä½¿ç”¨ Tailwind CSS
- éµå¾ªå“åº”å¼è®¾è®¡åŸåˆ™
- æ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜

## æäº¤è§„èŒƒ

### Commit æ ¼å¼
```
<type>(<scope>): <subject>

<body>
```

**Type**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•
- `chore`: æ„å»º/å·¥å…·

**ç¤ºä¾‹**:
```
feat(danmaku): æ·»åŠ å¼¹å¹•å¯†åº¦é™åˆ¶åŠŸèƒ½

- æ·»åŠ æ¯ç§’å¼¹å¹•æ•°é‡é™åˆ¶
- æ”¯æŒè‡ªå®šä¹‰é™åˆ¶æ•°å€¼
- è‡ªåŠ¨ä¿å­˜ç”¨æˆ·é…ç½®
```

## æ‰“åŒ…æµ‹è¯•

### Windows
```bash
pnpm electron:build:win
```

### æ£€æŸ¥æ‰“åŒ…ä½“ç§¯
```bash
Get-ChildItem release\win-unpacked -Recurse | Measure-Object -Property Length -Sum
```

### æµ‹è¯•æ¸…å•
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] è§†é¢‘æ’­æ”¾æ­£å¸¸
- [ ] å¼¹å¹•åŠ è½½æ­£å¸¸
- [ ] å…³é”®è¯å±è”½æœ‰æ•ˆ
- [ ] å¯†åº¦é™åˆ¶æœ‰æ•ˆ
- [ ] æ’­æ”¾è®°å½•ä¿å­˜
- [ ] æ”¶è—åŠŸèƒ½æ­£å¸¸
- [ ] åº”ç”¨é‡å¯åæ•°æ®ä¿ç•™

## å¸¸è§é—®é¢˜

### localStorage ä¸æŒä¹…åŒ–
- ç¡®ä¿ `electron/main.js` ä½¿ç”¨å›ºå®šç«¯å£ (39527)
- æ£€æŸ¥ `userData` è·¯å¾„æ˜¯å¦æ­£ç¡®

### å¼¹å¹•ä¸æ˜¾ç¤º
- æ£€æŸ¥å¼¹å¹•æ’ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½
- ç¡®è®¤å¼¹å¹•æ•°æ®æ ¼å¼æ­£ç¡®
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### æ‰“åŒ…ä½“ç§¯è¿‡å¤§
- ç¡®ä¿æ’é™¤äº†å…¶ä»–å¹³å°çš„ SWC æ¨¡å—
- æ£€æŸ¥ `package.json` çš„ `files` é…ç½®

## å‘å¸ƒæµç¨‹

1. æ›´æ–°ç‰ˆæœ¬å· (`package.json`)
2. æ›´æ–° `README.md` çš„ç‰ˆæœ¬ä¿¡æ¯
3. è¿è¡Œå®Œæ•´æµ‹è¯•
4. æ‰“åŒ…æ‰€æœ‰å¹³å°
5. åˆ›å»º GitHub Release
6. ä¸Šä¼ æ‰“åŒ…æ–‡ä»¶

## è®¸å¯è¯

MIT License - ç»§æ‰¿è‡ª MoonTV

## è”ç³»æ–¹å¼

- GitHub Issues: æŠ¥å‘Š Bug æˆ–æå‡ºåŠŸèƒ½å»ºè®®
- Pull Requests: æ¬¢è¿æäº¤ä»£ç è´¡çŒ®

---

å†æ¬¡æ„Ÿè°¢ä½ çš„è´¡çŒ®! ğŸ‰
